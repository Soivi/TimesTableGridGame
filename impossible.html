<!DOCTYPE html>
<html>
  <head>
    <title>Times Table Grid Game</title>
    
        <meta charset="utf-8" />
	<link href="styles/default.css" rel="stylesheet" type="text/css" />

  </head>
  <body>
  <p><div id="infoTime"></div>   <div id='infoCorrectAnswers'>&nbsp;</div><br /></p>
  <div id='infoRandomNumber'>&nbsp;</div> 
  
  <table id="theTable"> </table>
  
    <script type="text/javascript" charset="utf-8" src="jquery-1.8.2.min.js"></script>
    <script type="text/javascript" charset="utf-8" src="createTable.js"></script>
    <script type="text/javascript" charset="utf-8" src="options.js"></script>
    <script type="text/javascript" charset="utf-8" src="deviceReady.js"></script>
    <script type="text/javascript" charset="utf-8">


	var wantedNumber;
	var correctAnswers = 0;
	var endingTime = new Date().getTime() + 40000;
	var totalTime = 0;
	var xMultiplication =33;
	var yMultiplication = 47;
	var yourBestTime = 0;
	var difficultyTable = 5;
	var randomArrayNumbers = new Array();
	var db = window.openDatabase("Database", "1.0", "Cordova", 200000);


	function startTime(){
	document.getElementById('infoTime').innerHTML= "Time: " + Math.round((endingTime - new Date().getTime())/1000);
	if((endingTime - new Date().getTime())<0){
	timeOver();
}		
	t=setTimeout(function(){startTime()},500);
	}


function randomNumber() {
    correctAnswers++;
    if(correctAnswers==10){
    gameOver();
    }
    else{
    var isFound = false;
    	while(!isFound) {
    		var randomNumber = Math.floor(Math.random()*25);
    		wantedNumber = randomArrayNumbers[randomNumber];
    		if(wantedNumber!=null){
    			isFound=true;
    			randomArrayNumbers[randomNumber] = null;
    		}
    }	
	document.getElementById('infoRandomNumber').innerHTML = "PRODUCT: " + wantedNumber;
	document.getElementById('infoCorrectAnswers').innerHTML = " CORRECT: " + correctAnswers + "/10";
	}
}
	
function wrongQuess() {
	if(vibrationOff==0){
		navigator.notification.vibrate(500);	// Vibrate for 0.5 seconds
	}
	endingTime= endingTime-5000;
}
	
	
function quessNumber(quessedNumber) {
	if(quessedNumber==wantedNumber) {
	randomNumber();
	}else{
	wrongQuess();
	}
}
	
function gameOver(){
	totalTime = (endingTime - new Date().getTime())/1000;
        db.transaction(queryDB, errorCB);
}

function timeOver(){
			  navigator.notification.alert(
			    'Your time has run out!!!',  // message
			    exit(),         // callback
			    'GAME OVER',            // title
			    'Done'                  // buttonName
			);
}

	function exit() {
		navigator.app.backHistory();
	}

 // Populate the database 
    //
    function populateDB(tx) {
	tx.executeSql('UPDATE HIGHSCORESTABLE SET data="'+totalTime+'" WHERE id='+difficultyTable+'');
	db.transaction(exit);
    }

    // Query the database
    //
    function queryDB(tx) {
        tx.executeSql('SELECT * FROM HIGHSCORESTABLE', [], querySuccess, errorCB);
    }

    // Query the success callback
    //
    function querySuccess(tx, results) {
	yourBestTime = results.rows.item(difficultyTable).data;	
	if(yourBestTime == 0) {
			  navigator.notification.alert(
			    'You made the impossible possible!!! Your time was ' + totalTime + ' sec. Have a cookie!',  // message
			    db.transaction(populateDB, errorCB),         // callback
			    'CONGRATULATIONS',            // title
			    'Done'                  // buttonName
			);	
		}
	else if (totalTime > yourBestTime) {
			  navigator.notification.alert(
			    'You made a new record. Your time was ' + totalTime + ' sec',  // message
			    db.transaction(populateDB, errorCB),         // callback
			    'NEW RECORD',            // title
			    'Done'                  // buttonName
			);	
		}
	else {
		       navigator.notification.alert(
			    'Your time was ' + totalTime + ' sec.',  // message
			    exit(),         // callback
			    'Game Over',            // title
			    'OK'                  // buttonName
			);	
		}
    }

    // Transaction error callback
    //
    function errorCB(err) {
        console.log("Error processing SQL: "+err.code);
    }

    </script>
  
  </body>
</html>
