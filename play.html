<!DOCTYPE html>
<html>

<head>
  <title>Play</title>

  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link href="styles/default.css" rel="stylesheet" type="text/css" />

  <script type="text/javascript" charset="utf-8" src="js/localStorage.js"></script>
  <script type="text/javascript" charset="utf-8">

    // Wait for DOM to load before initializing
    window.addEventListener("pageshow", function () {
      initializeLocalStorage();
      loadHighScoresAndCalculateBlocks();
    });

    function loadHighScoresAndCalculateBlocks() {
      try {
        let totalProgressTime = 0;
        const highScores = getHighScores();
        const startLevel = 6;
        const finalBlockLevel = 15;

        // Check if player has completed level 15 (final level of block 1)
        if (highScores[finalBlockLevel] && highScores[finalBlockLevel] != 0) {
          // Sum up completion times from levels 6-15 (block 1 levels)
          for (let level = startLevel; level <= finalBlockLevel; level++) {
            if (highScores[level] && highScores[level] > 0) {
              totalProgressTime += parseFloat(highScores[level]);
            }
          }
          console.log(`Player progress time for levels ${startLevel}-${finalBlockLevel}:`, totalProgressTime);
        } else {
          console.log(`Player has not completed level ${finalBlockLevel} yet`);
        }

        // Calculate block unlock status and enable/disable block 2
        const block2Button = document.getElementById("block2Button");
        if (block2Button && calculateBlocks(totalProgressTime)) {
          block2Button.disabled = false;
          console.log("Block 2 unlocked for player");
        } else if (!block2Button) {
          console.warn("Block 2 button not found in DOM");
        }
        // If block2Unlocked is false, block2Button remains disabled
      } catch (error) {
        console.error("Error calculating player progress:", error);
      }
    }

    function exit() {
      if (window.history.length > 1) {
        window.history.back();
      } else {
        window.location.href = 'index.html';
      }
    }
  </script>

</head>

<body style="background-image:url(pictures/background.png);">

  <div class="indexButtons">
    <a href="block0/block0.html"><button id="block0Button">Block 0</button></a>
    <a href="block1/block1.html"><button id="block1Button">Block 1</button></a>
    <a href="block2/block2.html"><button disabled id="block2Button">Block 2</button></a>
  </div>
</body>

</html>