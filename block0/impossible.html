<!DOCTYPE html>
<html>

<head>
	<title>Times Table Grid Game</title>

	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<link href="../styles/default.css" rel="stylesheet" type="text/css" />
</head>

<body>
	<p>
		<div id="infoTime"></div>
		<div id='infoCorrectAnswers'>&nbsp;</div><br />
	</p>
	<div id='infoRandomNumber'>&nbsp;</div>

	<table id="theTable"> </table>

	<script type="text/javascript" charset="utf-8" src="../js/localStorage.js"></script>
	<script type="text/javascript" charset="utf-8" src="../js/createTable.js"></script>
	<script type="text/javascript" charset="utf-8" src="../js/deviceReady.js"></script>
	<script type="text/javascript" charset="utf-8">

		let endingTime = new Date().getTime() + 40000;
		let xMultiplication = 33;
		let yMultiplication = 47;
		let difficultyTable = 5;
		let answersToWin = 10;

		function startTime() {
			document.getElementById('infoTime').innerHTML = "Time: " + Math.round((endingTime - new Date().getTime()) / 1000);
			if(correctAnswers < answersToWin) {
				if ((endingTime - new Date().getTime()) < 0) {
					timeOver();
				} else {
				t = setTimeout(function () { startTime() }, 500);
				}
			}
		}

		function randomNumber() {
			correctAnswers++;
			if (correctAnswers == answersToWin) {
				gameOver();
			}
			else {
				let isFound = false;
				while (!isFound) {
					let randomNumber = Math.floor(Math.random() * 25);
					wantedNumber = randomArrayNumbers[randomNumber];
					if (wantedNumber != null) {
						isFound = true;
						randomArrayNumbers[randomNumber] = null;
					}
				}
				document.getElementById('infoRandomNumber').innerHTML = "PRODUCT: " + wantedNumber;
				document.getElementById('infoCorrectAnswers').innerHTML = " CORRECT: " + correctAnswers + "/" + answersToWin;
			}
		}

		function wrongGuess() {
			if (vibrationIsOn === true) {
				navigator.vibrate(500);	// Vibrate for 0.5 seconds
			}
			endingTime = endingTime - 5000;
		}

		function gameOver() {
			totalTime = (endingTime - new Date().getTime()) / 1000;
			checkAndSaveHighScore();
		}

		function timeOver() {
			alert('Your time has run out!!!');
			exit();
		}

		function exit() {
			window.history.back();
		}

		function checkAndSaveHighScore() {
			const highScores = getHighScores();
			yourBestTime = highScores[difficultyTable] || 0;
			
			if (yourBestTime == 0) {
				alert('You made the impossible possible!!! Your time was ' + totalTime + ' sec. Have a cookie!');
				highScores[difficultyTable] = totalTime;
				saveHighScores(highScores);
			}
			else if (totalTime > yourBestTime) {
				alert('You made a new record. Your time was ' + totalTime + ' sec');
				highScores[difficultyTable] = totalTime;
				saveHighScores(highScores);
			}
			else {
				alert('Your time was ' + totalTime + ' sec.');
			}
			exit();
		}
	</script>
</body>

</html>